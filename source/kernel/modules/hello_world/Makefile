MODULE_SOURCE_DIR=$(CURDIR)/src
MODULE_OD_64=$(OBJ_DIR)/64/kernel/modules/$(MODULE_NAME)/src
MODULE_OD_OUT=$(OBJ_DIR)/module

MODULE_OBJS+=$(MODULE_OD_64)/main.o
MODULE_OBJS+=$(MODULE_OD_64)/test.o

INCLUDE_DIRS+=$(CURDIR)/include

$(MODULE_OD_OUT)/$(MODULE_NAME).o: $(MODULE_OBJS)
	mkdir -p $(MODULE_DIR)
	mkdir -p $(MODULE_OD_OUT)

	$(LD64) -r $(MODULE_OBJS) -o $(MODULE_OD_OUT)/$(MODULE_NAME).o

$(MODULE_DIR)/$(MODULE_NAME).mod: $(MODULE_OD_OUT)/$(MODULE_NAME).o
	$(MKMOD_BIN) $(MODULE_OD_OUT)/$(MODULE_NAME).o $@

include $(MAKE_SCRIPTS)